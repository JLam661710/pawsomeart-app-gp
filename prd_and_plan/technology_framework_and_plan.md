PawsomeArt 定制应用技术选型与框架设计文档 (飞书直传方案)
暂时无法在飞书文档外展示此内容
1. 文档概述
1.1. 项目目标
本文档为 PawsomeArt 定制应用的开发提供最终技术指导。项目目标是构建一个轻量级移动端网页应用。其核心功能是收集用户的定制需求，并通过一个轻量级云函数作为中转，将包含图片附件的完整数据写入指定的飞书多维表格中。
1.2. 核心原则
- 最佳体验: 优先保证运营团队在飞书表格中能直接预览图片，优化工作流。
- 轻量后端: 采用 Serverless 云函数处理数据和文件上传，无需管理传统服务器。
- 开发简洁: 技术选型以简化开发、快速部署为最高优先级。
2. 技术栈选型
暂时无法在飞书文档外展示此内容
3. 应用架构与数据流
本应用采用“前端 + 轻量后端”架构，数据流清晰高效：
1. 用户访问: 用户在微信中扫码，打开部署在 Vercel 上的 React 应用。
2. 前端交互: 用户在应用中填写表单，选择并上传图片。
3. 数据打包 (前端): 用户点击提交按钮时，前端将所有文本数据和图片文件打包成一个 FormData 对象。
4. 提交到云函数 (前端): 前端使用 fetch API，将 FormData 对象发送到我们部署在 Vercel 上的 Serverless Function 端点（例如 /api/submit）。
5. 云函数处理 (后端): 这是关键的自动化处理步骤：
6. a. 云函数接收到前端发来的数据。
7. b. 第一步 - 上传图片: 云函数调用飞书的**“上传附件”API**，将图片文件逐个上传到飞书的服务器，并从飞书获取每张图片的 file_token（图片收据）。
8. c. 第二步 - 写入数据: 云函数将收到的文本数据（如手机号、款式）和上一步获取的 file_token 数组，组装成符合飞书**“新增记录”API**要求的 JSON 格式。
9. d. 第三步 - 完成: 云函数调用飞书的“新增记录”API，将数据写入你的多维表格。飞书会根据 file_token 自动在表格的附件列中显示图片。
10. 流程结束: 云函数向前端返回成功信息，前端随即跳转到最终的引流页面。
11. 飞书多维表格数据结构 (增强版)
为确保数据能被正确、完整、结构化地接收，从而支持后续高效的运营和自动化流程，我们推荐采用以下经过优化的飞书多维表格列（字段）设计。

#### A. 订单基础信息
| 字段名 (Field Name) | 字段类型 (Type) | 描述 (Description) |
| :--- | :--- | :--- |
| **订单号** | `文本` | 唯一标识每个订单的ID，建议格式 `PA-YYYYMMDD-HHMM-XXXXXX`。 |
| **提交时间** | `创建时间` | 记录用户提交表单的精确时间，自动填充。 |
| **产品系列** | `单选` | 对应 `product_sort.md` 的两大分类，如“全新艺术创作系列”。 |
| **具体款式** | `单选` | 对应具体的画像风格，如“经典定制款”、“名画致敬款”等。 |
| **宠物数量** | `数字` | 用户选择的参与画像的宠物数量。 |
| **画像尺寸** | `单选` | 用户选择的画像尺寸，如“8寸”、“A4”、“大尺寸”。 |

#### B. 价格与状态
| 字段名 (Field Name) | 字段类型 (Type) | 描述 (Description) |
| :--- | :--- | :--- |
| **预估价格** | `货币` | 根据用户选择自动计算的初始价格。 |
| **最终价格** | `货币` | 经运营人员确认或调整后的最终成交价格。 |
| **订单状态** | `单选` | 跟踪订单生命周期，如“待处理”、“设计中”、“待确认”、“已完成”、“已取消”。 |

#### C. 客户信息
| 字段名 (Field Name) | 字段类型 (Type) | 描述 (Description) |
| :--- | :--- | :--- |
| **客户手机号** | `文本` | 用户的手机号，用于后续沟通。 |
| **客户邮箱** | `文本` | 用户的邮箱，用于后续沟通。 |
| **客户备注** | `多行文本` | 用户在提交时留下的任何额外要求或说明。 |

#### D. 定制化详情 (核心)
这部分字段用于精确捕捉用户的每一个定制化选择，是实现高质量定制的关键。

| 字段名 (Field Name) | 字段类型 (Type) | 描述 (Description) |
| :--- | :--- | :--- |
| **宠物照片** | `附件` | 用户上传的宠物照片，可多张。这是生成画像的核心素材。 |
| **背景设定方式** | `单选` | 记录背景选择的来源，如“文字描述”、“上传图片”、“推荐图库”。 |
| **背景-文字描述** | `多行文本` | 如果背景设定方式为“文字描述”，则此字段记录具体内容。 |
| **背景-上传图片** | `附件` | 如果背景设定方式为“上传图片”，则此字段记录用户上传的背景图片。 |
| **背景-推荐选择** | `文本` | 如果背景设定方式为“推荐图库”，则此字段记录所选推荐背景的编号或名称。 |
| **名画选择方式** | `单选` | (仅名画致敬款) 记录名画选择来源，如“上传图片”、“推荐图库”。 |
| **名画-上传图片** | `附件` | (仅名画致敬款) 用户上传的参考名画图片。 |
| **名画-推荐选择** | `文本` | (仅名画致敬款) 所选推荐名画的编号或名称。 |
| **爱宠个性描述** | `多行文本` | (仅经典定制款) 用户对宠物性格、特点的描述，用于创作。 |


云函数需要发送给飞书的 JSON 格式 (示例):
```json
{
  "fields": {
    "订单号": "PA-20250818-1100-C3PO01",
    "产品系列": "全新艺术创作系列",
    "具体款式": "经典定制款",
    "宠物数量": 1,
    "画像尺寸": "8寸",
    "预估价格": 188,
    "订单状态": "待处理",
    "客户联系方式": "13900000001",
    "客户备注": "背景色请使用柔和的蓝色。",
    "宠物照片": [
      { "file_token": "boxcnDog001Tokenxxxxxx" },
      { "file_token": "boxcnDog002Tokenxxxxxx" },
      { "file_token": "boxcnDog003Tokenxxxxxx" }
    ],
    "背景设定方式": "文字描述",
    "背景-文字描述": "柔和的蓝色",
    "爱宠个性描述": "我家狗狗叫旺财，是一只非常温顺的金毛，性格很粘人，喜欢傻笑。"
  }
}
```
12. 项目文件夹结构
此结构适用于 Vercel 平台，前端和云函数代码在同一个项目中。
pawsomeart-app/
├── api/                   # 存放 Serverless Function 的代码
│   └── submit.js          # 核心处理逻辑就在这个文件里
├── public/                # 静态资源
├── src/
│   ├── assets/            # 存放所有静态图片资源
│   ├── components/        # 可复用的 UI 组件
│   ├── constants/         # 存放常量
│   ├── pages/             # 页面级组件
│   ├── utils/             # 工具函数
│   ├── App.jsx
│   └── main.jsx
├── .env.local             # 环境变量文件
├── package.json
└── vercel.json            # Vercel 部署配置文件
13. 给 Cursor 的核心开发指令
14. 初始化项目: 使用 Vite 创建一个新的 React + Tailwind CSS 项目。
15. 环境变量: 在项目根目录创建 .env.local 文件，用于存放飞书的 APP_ID, APP_SECRET, TABLE_ID 等敏感信息。
16. 创建云函数: 在项目根目录创建 api/submit.js 文件。这是我们的后端处理逻辑。
17. 云函数逻辑 (api/submit.js):
18. a. 获取飞书 Tenant Access Token: 函数首先需要根据 APP_ID 和 APP_SECRET 获取操作飞书 API 的凭证。
19. b. 处理请求: 解析从前端发来的 multipart/form-data 请求，分离出文本字段和文件。
20. c. 上传图片: 遍历所有图片文件，调用飞书的上传附件 API (/open-apis/drive/v1/medias/upload_all)，获取 file_token。
21. d. 组装数据: 按照 第 4 节 的格式，将文本字段和 file_token 组装成最终的 JSON payload。
22. e. 写入表格: 调用飞书的新增记录 API (/open-apis/bitable/v1/apps/:app_token/tables/:table_id/records)，将 payload 写入表格。
23. f. 返回响应: 向前端返回成功或失败的信息。
24. 前端提交逻辑:
  - 修改 handleSubmit 函数。
  - 使用 new FormData() 来创建一个表单数据对象。
  - 将所有文本字段和图片文件 append 到这个 FormData 对象中。
  - 使用 fetch 函数，向我们自己的后端端点 /api/submit 发送这个 FormData 对象。
  - 根据返回结果，进行页面跳转或错误提示。
核心开发者文档链接列表：
1. 前端框架与样式
- React 官方文档:
  - https://react.dev/
  - 用途: 用于构建整个应用的用户界面。
- Vite 官方指南:
  - https://vitejs.dev/guide/
  - 用途: 项目的构建工具，Cursor 需要用它来初始化和运行项目。
- Tailwind CSS 官方文档:
  - https://tailwindcss.com/docs/
  - 用途: 用于快速构建应用的样式和布局。
2. 部署与云函数
- Vercel Serverless Functions 文档:
  - https://vercel.com/docs/functions/serverless-functions
  - 用途: 这是关于如何创建 api/submit.js 这个云函数的官方指南，是项目的后端核心。
3. 飞书开放平台 API (最关键的部分)
你需要把这些链接清晰地指向给 Cursor，因为它需要调用这些 API 来完成数据写入。
- 获取 Tenant Access Token (调用凭证):
  - https://open.feishu.cn/document/ukTMukTMukTM/ukDNz4SO0MjL5QzM/auth-v3/auth/tenant_access_token_internal
  - 用途: 这是所有后续操作的第一步，云函数需要先获取这个“令牌”才能和飞书的服务器通信。
- 上传附件 (上传图片):
  - https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/drive-v1/media/upload_all
  - 用途: 云函数会调用这个 API，把用户上传的图片文件发送到飞书，并换取 file_token。
- 向多维表格中新增一条记录:
  - https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/bitable-v1/app-table-record/create
  - 用途: 这是最后一步，云函数将所有文本数据和从上一步获取的 file_token 一起发送到这个 API，从而在你的表格里创建新的一行。